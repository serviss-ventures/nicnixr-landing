# NixR Username System Documentation

## Overview
NixR implements a Reddit-style username system where every user gets a permanent username from the moment they start using the app, even as anonymous users.

## Key Concepts

### 1. **Username (Permanent)**
- Generated automatically when user first opens the app
- Format: `StrongWarrior`, `BravePhoenix`, `MightyLion123`
- Never changes, even when user converts from anonymous to registered
- Used in URLs: `/u/StrongWarrior`
- Displayed as: `@StrongWarrior` in the community

### 2. **Display Name (Changeable)**
- Initially set to same as username
- Users can change this anytime in settings
- Shows in UI but username remains in URLs
- Example: Username `@StrongWarrior` could have display name "John Smith"

### 3. **Anonymous Users**
- Get a real username immediately (not `user_123456`)
- Email is set to `{uuid}@nixr.app` internally
- Can do everything except certain premium features
- Username persists when they register with real email

## Username Generation

### Algorithm
```sql
-- Combines random adjective + noun
-- Examples: StrongWarrior, BravePhoenix, MightyLion

Adjectives: Strong, Brave, Bold, Fierce, Mighty, Swift, Wise, Noble, Proud, Free, 
            Bright, Clear, Fresh, Pure, True, Calm, Cool, Zen, Chill, Ready

Nouns: Warrior, Fighter, Champion, Victor, Hero, Phoenix, Eagle, Lion, Tiger, Wolf,
       Mountain, Thunder, Storm, Lightning, Wind, Star, Sun, Moon, Sky, Dream
```

### Uniqueness
- If `StrongWarrior` exists, tries `StrongWarrior1`, `StrongWarrior2`, etc.
- Fallback: `NixrUser{timestamp}` if all combinations exhausted

## User Flow

### 1. **App First Launch**
```
User opens app â†’ Anonymous auth â†’ Database trigger creates:
- UUID (from Supabase auth)
- Username: "BravePhoenix"  
- Display Name: "BravePhoenix"
- Email: "{uuid}@nixr.app"
- is_anonymous: true
```

### 2. **During Onboarding**
- User identified by UUID and username
- All tracking uses proper UUID
- Username shown in UI: "Welcome, @BravePhoenix!"

### 3. **Registration/Payment**
```javascript
// When user provides real email
await supabase.rpc('convert_anonymous_to_registered', {
  user_id: currentUser.id,
  new_email: 'john@example.com'
});

// Result:
// - Username: UNCHANGED (still @BravePhoenix)
// - Email: Updated to john@example.com
// - is_anonymous: false
```

## Database Schema

```sql
-- Users table
CREATE TABLE public.users (
  id UUID PRIMARY KEY,                    -- Supabase auth UUID
  email TEXT UNIQUE NOT NULL,            -- Real or {uuid}@nixr.app
  username TEXT UNIQUE NOT NULL,         -- Permanent username
  display_name TEXT,                     -- Changeable display name
  is_anonymous BOOLEAN DEFAULT FALSE,    -- Track anonymous users
  -- ... other fields
);
```

## Community Integration

### Posts Display
```
@BravePhoenix (or "John Smith" if display name set)
"Just hit 30 days clean! ðŸ’ª"
```

### Profile URLs
```
/u/BravePhoenix          -- Always uses username
/community/@BravePhoenix -- Alternative format
```

### Mentions
```
"Great job @BravePhoenix on hitting 30 days!"
```

## Implementation Details

### Mobile App
```typescript
// User type includes both
interface User {
  id: string;              // UUID
  username: string;        // Permanent @username
  displayName?: string;    // Changeable name
  isAnonymous: boolean;
}

// Welcome screen creates user
const { data } = await supabase.auth.signInAnonymously();
const profile = await supabase.from('users').select('*').eq('id', data.user.id).single();
// profile.username is auto-generated by database
```

### Benefits
1. **No Migration Needed**: Username exists from start
2. **Clean URLs**: `/u/BravePhoenix` vs `/u/user_1750195011816`
3. **User Identity**: People can build reputation even as anonymous
4. **Smooth Conversion**: Nothing changes when they register
5. **Privacy**: Can use app fully without revealing email

### Edge Cases Handled
- Username collision (adds numbers)
- Database trigger failures (client-side fallback)
- Empty usernames (validation prevents)
- Special characters (only alphanumeric allowed)

## Security
- Usernames are public (shown in community)
- Email only visible to user themselves
- UUID never exposed in UI
- Anonymous users tracked same as registered for analytics 